<div class="container-fluid p-4">
  <div class="row g-3 mb-4">
    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Users</div>
          <div class="fs-4 fw-bold"><%= total_users %></div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Products</div>
          <div class="d-flex align-items-baseline justify-content-between">
            <div class="fs-4 fw-bold"><%= total_products %></div>
              <span class="badge bg-light text-success">Published: <%= published_products %></span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Orders</div>
          <div class="d-flex align-items-baseline justify-content-between">
            <div class="fs-4 fw-bold"><%= total_orders %></div>
              <span class="badge bg-light text-success">Paid: <%= paid_orders_count %></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Seller Applications</div>
          <div class="d-flex flex-column">
            <div class="fs-4 fw-bold"><%= total_seller_applications %></div>
            <div class="d-flex gap-1 mt-1 flex-wrap">
              <span class="badge bg-light text-warning">Pending: <%= pending_seller_applications %></span>
              <span class="badge bg-light text-success">Approved: <%= approved_seller_applications %></span>
              <span class="badge bg-light text-danger">Rejected: <%= rejected_seller_applications %></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Revenue</div>
          <div class="fs-4 fw-bold">$<%= number_with_precision(revenue, precision: 2) %></div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card h-100">
        <div class="card-body">
          <div class="text-muted">Reviews</div>
          <div class="fs-4 fw-bold"><%= total_reviews %></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-light fw-semibold">Top products</div>
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col" style="width: 80px">Image</th>
            <th scope="col">Name</th>
            <th scope="col">Seller</th>
            <th scope="col">Category</th>
            <th scope="col" class="text-end">Price</th>
            <th scope="col" class="text-end">Unit sold</th>
          </tr>
        </thead>
        <tbody>
          <% (@top_products || []).each do |product| %>
            <tr onclick="window.location='<%= admin_product_path(product) %>'" style="cursor: pointer;">
              <td>
                <%= image_tag(product.respond_to?(:thumbnail) && product.thumbnail.present? ? product.thumbnail : asset_path('place_holder.jpg'),
                              class: 'img-thumbnail',
                              style: 'width: 50px; height: 50px; object-fit: cover;') %>
              </td>
              <td>
                <div class="fw-semibold">
                  <%= link_to product.name, admin_product_path(product) %>
                </div>
                <small class="text-muted"><%= truncate(product.description.to_s, length: 60) %></small>
              </td>
              <td>
                <span class="badge rounded-pill bg-light text-dark">
                  <i class="fas fa-store me-1"></i>
                  <%= product.user&.email || "Unknown Seller" %>
                </span>
              </td>
              <td>
                <span class="badge rounded-pill bg-light text-dark">
                  <i class="fas fa-tag me-1"></i>
                  <%= product.category&.name || "Uncategorized" %>
                </span>
              </td>
              <td class="text-end">
                $<%= number_with_precision(product.price, precision: 2) %>
              </td>
              <td class="text-end">
                <%= product.units_sold %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-header bg-light fw-semibold">Top users (by items sold)</div>
    <div class="card-body p-0">
      <table class="table table-hover mb-0">
        <thead><tr><th>User</th><th class="text-end">Items sold</th></tr></thead>
        <tbody>
          <% (top_sellers || []).each do |seller| %>
            <tr>
              <td><%= link_to seller.email, (defined?(admin_user_path) ? admin_user_path(seller) : "#") %></td>
              <td class="text-end"><%= seller.try(:items_sold).to_i %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>